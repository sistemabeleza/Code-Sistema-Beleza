generator client {
    provider = "prisma-client-js"
    binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
    output = "/home/ubuntu/sistema_salao_beleza/nextjs_space/node_modules/.prisma/client"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

// Modelo principal de Multi-tenancy
model Salao {
  id                  String               @id @default(cuid())
  nome                String
  document_type       DocumentType?        // CPF ou CNPJ
  document            String?              // Documento (somente números)
  telefone            String?
  email               String?
  endereco            String?
  horario_funcionamento String?
  logo                String?              // URL do logo
  foto_1              String?              // URL da foto 1 do salão
  foto_2              String?              // URL da foto 2 do salão
  slug                String?              @unique  // Link personalizado para agendamento (ex: meusalao)
  descricao           String?              // Descrição do salão para o site público
  cor_tema            String?              @default("#3B82F6")
  instagram_handle    String?              // @usuario ou usuario
  whatsapp_number     String?              // Formato E.164 (+5527999999999)
  timezone            String?              @default("America/Sao_Paulo")
  plano               PlanoSalao           @default(BASICO)
  status              StatusSalao          @default(ATIVO)
  data_criacao        DateTime             @default(now())
  data_atualizacao    DateTime             @updatedAt

  // Relacionamentos
  usuarios            User[]
  clientes            Cliente[]
  profissionais       Profissional[]
  servicos            Servico[]
  produtos            Produto[]
  agendamentos        Agendamento[]
  vendas              Venda[]
  lancamentos         Lancamento[]
  relatorios          RelatorioFinanceiro[]
  configuracao        ConfiguracaoSalao?

  @@map("saloes")
}

// NextAuth.js Models
model User {
  id            String          @id @default(cuid())
  name          String?
  email         String          @unique
  emailVerified DateTime?
  image         String?
  password      String?         // Para autenticação por senha
  accounts      Account[]
  sessions      Session[]
  authenticator Authenticator[]

  // Sistema específico
  salao_id      String
  tipo          TipoUsuario     @default(ADMIN)
  status        StatusUsuario   @default(ATIVO)
  telefone      String?
  cpf           String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  salao         Salao           @relation(fields: [salao_id], references: [id], onDelete: Cascade)

  @@map("users")
}

model Account {
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@id([identifier, token])
  @@map("verification_tokens")
}

model Authenticator {
  credentialID         String  @unique
  userId               String
  providerAccountId    String
  credentialPublicKey  String
  counter              Int
  credentialDeviceType String
  credentialBackedUp   Boolean
  transports           String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, credentialID])
  @@map("authenticators")
}

// Modelos do Sistema de Salão

model Cliente {
  id                  String               @id @default(cuid())
  salao_id            String
  nome                String
  telefone            String
  email               String?
  cpf                 String?
  data_nascimento     DateTime?
  endereco            String?
  observacoes         String?
  status              StatusCliente        @default(ATIVO)
  foto                String?              // URL da foto
  data_cadastro       DateTime             @default(now())
  data_atualizacao    DateTime             @updatedAt

  // Relacionamentos
  salao               Salao                @relation(fields: [salao_id], references: [id], onDelete: Cascade)
  agendamentos        Agendamento[]
  vendas              Venda[]
  fidelidade          FidelidadeCliente?

  @@map("clientes")
}

model Profissional {
  id                    String               @id @default(cuid())
  salao_id              String
  nome                  String
  telefone              String?
  foto                  String?              // URL da foto
  status                StatusProfissional   @default(ATIVO)
  work_hours            String?              // JSON com horários de trabalho por dia
  commission_type       CommissionType?      // Tipo de comissão (porcentagem ou valor fixo)
  commission_value      Decimal?             @db.Decimal(10,2) // Valor da comissão
  data_cadastro         DateTime             @default(now())
  data_atualizacao      DateTime             @updatedAt

  // Relacionamentos
  salao                 Salao                @relation(fields: [salao_id], references: [id], onDelete: Cascade)
  agendamentos          Agendamento[]
  pagamentos            Pagamento[]

  @@map("profissionais")
}

model Servico {
  id                  String               @id @default(cuid())
  salao_id            String
  nome                String
  preco               Decimal              @db.Decimal(10,2)
  duracao_minutos     Int
  status              StatusServico        @default(ATIVO)
  data_cadastro       DateTime             @default(now())
  data_atualizacao    DateTime             @updatedAt

  // Relacionamentos
  salao               Salao                @relation(fields: [salao_id], references: [id], onDelete: Cascade)
  agendamentos        Agendamento[]
  itens_venda         ItemVenda[]

  @@map("servicos")
}

model Agendamento {
  id                  String               @id @default(cuid())
  salao_id            String
  cliente_id          String
  profissional_id     String
  servico_id          String
  data                DateTime
  hora_inicio         DateTime
  hora_fim            DateTime
  status              StatusAgendamento    @default(AGENDADO)
  origem              OrigemAgendamento    @default(MANUAL)  // Se veio do site ou foi manual
  observacoes         String?
  valor_cobrado       Decimal?             @db.Decimal(10,2)
  desconto            Decimal?             @default(0) @db.Decimal(10,2)
  data_criacao        DateTime             @default(now())
  data_atualizacao    DateTime             @updatedAt

  // Relacionamentos
  salao               Salao                @relation(fields: [salao_id], references: [id], onDelete: Cascade)
  cliente             Cliente              @relation(fields: [cliente_id], references: [id], onDelete: Cascade)
  profissional        Profissional         @relation(fields: [profissional_id], references: [id], onDelete: Cascade)
  servico             Servico              @relation(fields: [servico_id], references: [id], onDelete: Cascade)
  pagamento           Pagamento?

  @@map("agendamentos")
}

model Pagamento {
  id                  String               @id @default(cuid())
  agendamento_id      String?              @unique
  venda_id            String?              @unique
  profissional_id     String?              // Para comissões
  valor               Decimal              @db.Decimal(10,2)
  forma_pagamento     FormaPagamento
  status              StatusPagamento      @default(PENDENTE)
  data_pagamento      DateTime?
  data_vencimento     DateTime?
  observacoes         String?
  parcelas            Int                  @default(1)
  parcela_atual       Int                  @default(1)
  data_criacao        DateTime             @default(now())
  data_atualizacao    DateTime             @updatedAt

  // Relacionamentos
  agendamento         Agendamento?         @relation(fields: [agendamento_id], references: [id], onDelete: Cascade)
  venda               Venda?               @relation(fields: [venda_id], references: [id], onDelete: Cascade)
  profissional        Profissional?        @relation(fields: [profissional_id], references: [id])

  @@map("pagamentos")
}

model Produto {
  id                  String               @id @default(cuid())
  salao_id            String
  nome                String
  descricao           String?
  codigo_barras       String?
  preco_custo         Decimal              @db.Decimal(10,2)
  preco_venda         Decimal              @db.Decimal(10,2)
  quantidade_estoque  Int                  @default(0)
  estoque_minimo      Int                  @default(5)
  categoria           String?
  marca               String?
  fornecedor          String?
  foto                String?              // URL da foto
  status              StatusProduto        @default(ATIVO)
  data_cadastro       DateTime             @default(now())
  data_atualizacao    DateTime             @updatedAt

  // Relacionamentos
  salao               Salao                @relation(fields: [salao_id], references: [id], onDelete: Cascade)
  movimentacoes       MovimentacaoEstoque[]
  itens_venda         ItemVenda[]

  @@unique([salao_id, codigo_barras])
  @@map("produtos")
}

model MovimentacaoEstoque {
  id                  String               @id @default(cuid())
  produto_id          String
  tipo                TipoMovimentacao
  quantidade          Int
  valor_unitario      Decimal?             @db.Decimal(10,2)
  motivo              String?
  data_movimentacao   DateTime             @default(now())
  usuario_id          String?

  // Relacionamentos
  produto             Produto              @relation(fields: [produto_id], references: [id], onDelete: Cascade)

  @@map("movimentacoes_estoque")
}

model Venda {
  id                  String               @id @default(cuid())
  salao_id            String
  cliente_id          String?
  numero_venda        String
  valor_total         Decimal              @db.Decimal(10,2)
  desconto            Decimal              @default(0) @db.Decimal(10,2)
  valor_final         Decimal              @db.Decimal(10,2)
  observacoes         String?
  data_venda          DateTime             @default(now())
  data_atualizacao    DateTime             @updatedAt

  // Relacionamentos
  salao               Salao                @relation(fields: [salao_id], references: [id], onDelete: Cascade)
  cliente             Cliente?             @relation(fields: [cliente_id], references: [id])
  itens               ItemVenda[]
  pagamento           Pagamento?

  @@unique([salao_id, numero_venda])
  @@map("vendas")
}

model ItemVenda {
  id                  String               @id @default(cuid())
  venda_id            String
  produto_id          String?
  servico_id          String?
  quantidade          Int                  @default(1)
  valor_unitario      Decimal              @db.Decimal(10,2)
  desconto            Decimal              @default(0) @db.Decimal(10,2)
  valor_total         Decimal              @db.Decimal(10,2)

  // Relacionamentos
  venda               Venda                @relation(fields: [venda_id], references: [id], onDelete: Cascade)
  produto             Produto?             @relation(fields: [produto_id], references: [id])
  servico             Servico?             @relation(fields: [servico_id], references: [id])

  @@map("itens_venda")
}

model FidelidadeCliente {
  id                  String               @id @default(cuid())
  cliente_id          String               @unique
  pontos_acumulados   Int                  @default(0)
  pontos_utilizados   Int                  @default(0)
  nivel               String?              @default("BRONZE")
  data_ultimo_ponto   DateTime?
  data_cadastro       DateTime             @default(now())
  data_atualizacao    DateTime             @updatedAt

  // Relacionamentos
  cliente             Cliente              @relation(fields: [cliente_id], references: [id], onDelete: Cascade)

  @@map("fidelidade_clientes")
}

model ConfiguracaoSalao {
  id                  String               @id @default(cuid())
  salao_id            String               @unique
  configuracoes_json  String?              // Configurações extras em JSON
  data_atualizacao    DateTime             @updatedAt

  // Relacionamentos
  salao               Salao                @relation(fields: [salao_id], references: [id], onDelete: Cascade)

  @@map("configuracoes_salao")
}

// Enums
enum TipoUsuario {
  ADMIN
  GERENTE
  ATENDENTE
}

enum StatusUsuario {
  ATIVO
  INATIVO
  SUSPENSO
}

enum StatusCliente {
  ATIVO
  INATIVO
  BLOQUEADO
}

enum StatusProfissional {
  ATIVO
  INATIVO
  FERIAS
  LICENCA
}

enum StatusServico {
  ATIVO
  INATIVO
}

enum StatusAgendamento {
  AGENDADO
  CONFIRMADO
  EM_ANDAMENTO
  REALIZADO
  CANCELADO
  NAO_COMPARECEU
}

enum FormaPagamento {
  DINHEIRO
  PIX
  DEBITO
  CREDITO
  BOLETO
}

enum StatusPagamento {
  PENDENTE
  PAGO
  CANCELADO
  ESTORNADO
}

enum StatusProduto {
  ATIVO
  INATIVO
  DESCONTINUADO
}

enum TipoMovimentacao {
  ENTRADA
  SAIDA
  AJUSTE
  PERDA
}

enum PlanoSalao {
  BASICO
  PROFISSIONAL
  PREMIUM
  ENTERPRISE
}

enum StatusSalao {
  ATIVO
  INATIVO
  SUSPENSO
  TRIAL
}

enum OrigemAgendamento {
  MANUAL
  SITE
  WHATSAPP
  TELEFONE
}

enum DocumentType {
  CPF
  CNPJ
}

enum CommissionType {
  PERCENTAGE
  FIXED
}

enum TipoLancamento {
  RECEITA
  DESPESA
}

enum CategoriaLancamento {
  // Receitas
  SERVICO
  PRODUTO
  OUTRO_RECEITA
  
  // Despesas
  SALARIO
  FORNECEDOR
  ALUGUEL
  AGUA
  LUZ
  INTERNET
  TELEFONE
  PRODUTO_COMPRA
  EQUIPAMENTO
  MARKETING
  MANUTENCAO
  OUTRO_DESPESA
}

// Modelo de lançamentos financeiros (receitas e despesas)
model Lancamento {
  id                String                @id @default(cuid())
  salao_id          String
  tipo              TipoLancamento
  categoria         CategoriaLancamento
  descricao         String
  valor             Decimal               @db.Decimal(10, 2)
  data_lancamento   DateTime              @default(now())
  observacoes       String?
  data_criacao      DateTime              @default(now())
  data_atualizacao  DateTime              @updatedAt

  // Relacionamentos
  salao             Salao                 @relation(fields: [salao_id], references: [id], onDelete: Cascade)

  @@map("lancamentos")
}

// Modelo de relatórios financeiros salvos
model RelatorioFinanceiro {
  id                String                @id @default(cuid())
  salao_id          String
  tipo_periodo      String                // SEMANAL, MENSAL
  data_inicio       DateTime
  data_fim          DateTime
  total_receitas    Decimal               @db.Decimal(10, 2)
  total_despesas    Decimal               @db.Decimal(10, 2)
  saldo             Decimal               @db.Decimal(10, 2)
  dados_json        String                @db.Text  // JSON com detalhes do relatório
  data_criacao      DateTime              @default(now())

  // Relacionamentos
  salao             Salao                 @relation(fields: [salao_id], references: [id], onDelete: Cascade)

  @@map("relatorios_financeiros")
}
